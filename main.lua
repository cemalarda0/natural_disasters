local players, admins = {}, {
    ["Poklava#0000"] = true,
    ["Kralizmox#0000"] = true
}
local lobbyMaps, currentMap, currentMode, currentEvent =
    {'<C><P MEDATA=";;;;-0;0:::1-" D="x_nekodancer/x_mondes/x_9.jpg,0,17" Ca ="" /><Z><S><S T="12" X="388" Y="392" L="873" H="10" P="0,0,0.3,0.2,0,0,0,0" o="324650" m=""/><S L="873" o="324650" H="10" X="386" Y="10" T="12" P="0,0,0.3,0.2,0,0,0,0" /><S L="873" o="324650" H="10" X="-7" Y="254" T="12" P="0,0,0.3,0.2,90,0,0,0" /><S L="873" o="324650" H="10" X="804" Y="229" T="12" P="0,0,0.3,0.2,90,0,0,0" /></S><D /><O /><L /></Z></C>',
     '<C><P MEDATA=";;;;-0;0:::1-" D="x_nekodancer/x_mondes/x_11.jpg,0,17" Ca ="" /><Z><S><S T="12" X="388" Y="392" L="873" H="10" P="0,0,0.3,0.2,0,0,0,0" o="324650" m=""/><S P="0,0,0.3,0.2,0,0,0,0" L="873" o="324650" X="386" Y="10" T="12" H="10" /><S P="0,0,0.3,0.2,90,0,0,0" L="873" o="324650" X="-7" Y="254" T="12" H="10" /><S P="0,0,0.3,0.2,90,0,0,0" L="873" o="324650" X="804" Y="229" T="12" H="10" /></S><D /><O /><L /></Z></C>',
     '<C><P MEDATA=";;;;-0;0:::1-" D="x_nekodancer/x_mondes/x_12.jpg,0,17" Ca ="" /><Z><S><S T="12" X="388" Y="392" L="873" H="10" P="0,0,0.3,0.2,0,0,0,0" o="324650" m=""/><S P="0,0,0.3,0.2,0,0,0,0" L="873" o="324650" H="10" Y="10" T="12" X="386" /><S P="0,0,0.3,0.2,90,0,0,0" L="873" o="324650" H="10" Y="254" T="12" X="-7" /><S P="0,0,0.3,0.2,90,0,0,0" L="873" o="324650" H="10" Y="229" T="12" X="804" /></S><D /><O /><L /></Z></C>',
     '<C><P MEDATA=";;;;-0;0:::1-" D="x_nekodancer/x_mondes/x_2.jpg,0,17" Ca ="" /><Z><S><S T="12" X="388" Y="392" L="873" H="10" P="0,0,0.3,0.2,0,0,0,0" o="324650" m=""/><S L="873" o="324650" H="10" X="386" Y="10" T="12" P="0,0,0.3,0.2,0,0,0,0" /><S L="873" o="324650" H="10" X="-7" Y="254" T="12" P="0,0,0.3,0.2,90,0,0,0" /><S L="873" o="324650" H="10" X="804" Y="229" T="12" P="0,0,0.3,0.2,90,0,0,0" /></S><D /><O /><L /></Z></C>'},
    0, "lobby", nil
local maps, mapObjects =
    {'<C><P MEDATA=";;;;-0;0:::1-" L="3000" H="3000" F="1" DS="m;195,2300,2800,2300" C="" Ca="" mc="" reload="true"/><Z><S><S T="6" X="1500" Y="2755" L="3000" H="500" P="1,1000,0.3,0,0,1,9999,0"/><S T="0" X="5" Y="3010" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="2995" Y="3010" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="3005" Y="2815" L="10" H="400" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="-5" Y="2815" L="10" H="400" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="8" X="1500" Y="3205" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="40000" m=""/><S T="0" X="1500" Y="3040" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="20000" m=""/><S T="8" X="1500" Y="3315" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="60000" m=""/><S T="0" X="1500" Y="3145" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="40000" m=""/><S T="0" X="1500" Y="3255" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="60000" m=""/><S T="0" X="1500" Y="3365" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="80000" m=""/><S T="8" X="1500" Y="3425" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="80000" m=""/><S T="8" X="1500" Y="2255" L="400" H="500" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="18 "/><S T="8" X="1500" Y="1910" L="600" H="130" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="16"/><S T="10" X="1140" Y="1825" L="120" H="300" P="1,0,0.3,0,0,0,0,0" lua="14"/><S T="10" X="1860" Y="1825" L="120" H="300" P="1,0,0.3,0,0,0,0,0" lua="15"/><S T="10" X="1740" Y="1695" L="120" H="300" P="1,0,0.3,0,0,0,0,0" lua="13"/><S T="10" X="1260" Y="1695" L="120" H="300" P="1,0,0.3,0,0,0,0,0" lua="12"/><S T="8" X="1500" Y="1645" L="120" H="400" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="11"/><S T="8" X="1500" Y="1420" L="360" H="50" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="8"/><S T="10" X="1500" Y="1380" L="350" H="30" P="1,0,0.3,0,0,0,0,0" lua="7"/><S T="10" X="1500" Y="1350" L="300" H="30" P="1,0,0.3,0,0,0,0,0" lua="6"/><S T="10" X="1500" Y="1320" L="250" H="30" P="1,0,0.3,0,0,0,0,0" lua="5"/><S T="10" X="1500" Y="1290" L="200" H="30" P="1,0,0.3,0,0,0,0,0" lua="4"/><S T="10" X="1500" Y="1260" L="150" H="30" P="1,0,0.3,0,0,0,0,0" lua="3"/><S T="10" X="1500" Y="1230" L="100" H="30" P="1,0,0.3,0,0,0,0,0" lua="2"/><S T="10" X="1500" Y="1200" L="50" H="30" P="1,0,0.3,0,0,0,0,0" lua="1"/><S T="8" X="2650" Y="2250" L="500" H="500" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="58"/><S T="8" X="350" Y="2250" L="500" H="500" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="35"/><S T="8" X="2650" Y="1650" L="500" H="500" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="48"/><S T="8" X="350" Y="1647" L="500" H="500" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="25"/><S T="0" X="2625" Y="2430" L="150" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="63"/><S T="0" X="375" Y="2430" L="150" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="40"/><S T="0" X="2500" Y="2455" L="100" H="100" P="1,0,0.3,0.2,0,0,0,0" lua="64 "/><S T="0" X="500" Y="2455" L="100" H="100" P="1,0,0.3,0.2,0,0,0,0" lua="41"/><S T="0" X="2800" Y="2405" L="200" H="200" P="1,0,0.3,0.2,0,0,0,0" lua="62"/><S T="0" X="200" Y="2405" L="200" H="200" P="1,0,0.3,0.2,0,0,0,0" lua="39"/><S T="0" X="2875" Y="2230" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="61"/><S T="0" X="125" Y="2230" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="38"/><S T="0" X="2425" Y="2130" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="59"/><S T="0" X="575" Y="2130" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="36"/><S T="0" X="2875" Y="1780" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="53"/><S T="0" X="125" Y="1780" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="30"/><S T="0" X="2425" Y="1650" L="50" H="200" P="1,0,0.3,0.2,0,0,0,0" lua="51"/><S T="0" X="575" Y="1650" L="50" H="200" P="1,0,0.3,0.2,0,0,0,0" lua="28"/><S T="0" X="2875" Y="1520" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="49"/><S T="0" X="125" Y="1520" L="50" H="150" P="1,0,0.3,0.2,0,0,0,0" lua="26"/><S T="0" X="2650" Y="2180" L="300" H="46" P="1,0,0.3,0.2,0,0,0,0" lua="60"/><S T="0" X="350" Y="2180" L="300" H="46" P="1,0,0.3,0.2,0,0,0,0" lua="37"/><S T="0" X="2650" Y="1730" L="300" H="46" P="1,0,0.3,0.2,0,0,0,0" lua="52 "/><S T="0" X="350" Y="1730" L="300" H="46" P="1,0,0.3,0.2,0,0,0,0" lua="29"/><S T="0" X="2650" Y="1570" L="300" H="46" P="1,0,0.3,0.2,0,0,0,0" lua="50"/><S T="0" X="350" Y="1570" L="300" H="46" P="1,0,0.3,0.2,0,0,0,0" lua="27"/><S T="4" X="2500" Y="1950" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="57 "/><S T="4" X="200" Y="1950" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="31"/><S T="4" X="2550" Y="1350" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="45"/><S T="4" X="250" Y="1350" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="22"/><S T="4" X="2600" Y="1250" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="43"/><S T="4" X="300" Y="1250" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="20"/><S T="4" X="2700" Y="1252" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="44"/><S T="4" X="400" Y="1250" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="21"/><S T="4" X="2650" Y="1150" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="42"/><S T="4" X="350" Y="1150" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="19"/><S T="4" X="2800" Y="1950" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="54"/><S T="4" X="500" Y="1950" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="34 "/><S T="4" X="2750" Y="1350" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="47"/><S T="4" X="450" Y="1350" L="100" H="100" P="1,0,20,0.2,0,0,0,0" lua="24"/><S T="1" X="2600" Y="1950" L="100" H="100" P="1,0,0,0.2,0,0,0,0" lua="56"/><S T="1" X="300" Y="1950" L="100" H="100" P="1,0,0,0.2,0,0,0,0" lua="32"/><S T="1" X="2700" Y="1950" L="100" H="100" P="1,0,0,0.2,0,0,0,0" lua="55"/><S T="1" X="400" Y="1950" L="100" H="100" P="1,0,0,0.2,0,0,0,0" lua="33"/><S T="1" X="2650" Y="1350" L="100" H="100" P="1,0,0,0.2,0,0,0,0" lua="46"/><S T="1" X="350" Y="1350" L="100" H="100" P="1,0,0,0.2,0,0,0,0" lua="23"/><S T="4" X="1500" Y="1990" L="1200" H="30" P="1,0,20,0.2,0,0,0,0" lua="17"/><S T="1" X="5" Y="1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="1" X="2995" Y="1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="4" X="1380" Y="1645" L="120" H="400" P="1,0,20,0.2,0,0,0,0" lua="9"/><S T="4" X="1620" Y="1645" L="120" H="400" P="1,0,20,0.2,0,0,0,0" lua="10"/><S T="1" X="5" Y="-1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="1" X="2995" Y="-1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="8" X="1500" Y="3105" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="40000" m=""/></S><D/><O><O X="2500" Y="2455" C="22" P="0"/><O X="200" Y="2405" C="22" P="0"/><O X="2625" Y="2430" C="22" P="0"/><O X="375" Y="2430" C="22" P="0"/><O X="2800" Y="2405" C="22" P="0"/><O X="500" Y="2455" C="22" P="0"/><O X="2425" Y="2130" C="22" P="0"/><O X="575" Y="2130" C="22" P="0"/><O X="2650" Y="2180" C="22" P="0"/><O X="350" Y="2180" C="22" P="0"/><O X="2875" Y="2230" C="22" P="0"/><O X="125" Y="2230" C="22" P="0"/><O X="2875" Y="1780" C="22" P="0"/><O X="125" Y="1780" C="22" P="0"/><O X="2650" Y="1730" C="22" P="0"/><O X="350" Y="1730" C="22" P="0"/><O X="2425" Y="1650" C="22" P="0"/><O X="575" Y="1650" C="22" P="0"/><O X="2650" Y="1570" C="22" P="0"/><O X="350" Y="1570" C="22" P="0"/><O X="2875" Y="1520" C="22" P="0"/><O X="125" Y="1520" C="22" P="0"/></O><L/></Z></C>', -- [1-64]
     '<C><P MEDATA=";;;;-0;0:::1-" L="3000" H="3000" F="0" C="" Ca="" mc="" reload="true"/><Z><S><S T="6" X="1500" Y="2755" L="3000" H="500" P="1,1000,0.3,0,0,1,9999,0"/><S T="8" X="1500" Y="3100" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="50000" m=""/><S T="0" X="5" Y="3010" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="2995" Y="3010" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="3005" Y="2815" L="10" H="400" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="-5" Y="2815" L="10" H="400" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="1500" Y="3040" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="30000" m=""/><S T="8" X="1500" Y="3205" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="70000" m=""/><S T="0" X="1500" Y="3140" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="50000" m=""/><S T="8" X="1500" Y="3315" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="90000" m=""/><S T="0" X="1500" Y="3245" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="70000" m=""/><S T="0" X="1500" Y="3355" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="90000" m=""/><S T="8" X="1500" Y="3425" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="110000" m=""/><S T="1" X="5" Y="1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="1" X="2995" Y="1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="7" X="1501" Y="2205" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="1"/><S T="7" X="1150" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="29"/><S T="7" X="1200" Y="2445" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="22"/><S T="7" X="1300" Y="2445" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="23"/><S T="7" X="1400" Y="2445" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="24"/><S T="7" X="1500" Y="2445" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="25"/><S T="7" X="1600" Y="2445" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="26"/><S T="7" X="1700" Y="2445" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="27"/><S T="7" X="1800" Y="2445" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="28"/><S T="7" X="1750" Y="2405" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="21"/><S T="7" X="1700" Y="2365" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="15"/><S T="7" X="1650" Y="2325" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="10"/><S T="7" X="1600" Y="2285" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="6"/><S T="7" X="1550" Y="2245" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="3"/><S T="7" X="1450" Y="2245" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="2"/><S T="7" X="1400" Y="2285" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="4"/><S T="7" X="1500" Y="2285" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="5"/><S T="7" X="1350" Y="2325" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="7"/><S T="7" X="1450" Y="2325" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="8"/><S T="7" X="1550" Y="2325" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="9"/><S T="7" X="1300" Y="2365" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="11"/><S T="7" X="1400" Y="2365" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="12"/><S T="7" X="1500" Y="2365" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="13"/><S T="7" X="1601" Y="2365" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="14"/><S T="7" X="1250" Y="2405" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="16"/><S T="7" X="1350" Y="2405" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="17"/><S T="7" X="1450" Y="2405" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="18"/><S T="7" X="1550" Y="2405" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="19"/><S T="7" X="1650" Y="2405" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="20"/><S T="7" X="1250" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="30"/><S T="7" X="1350" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="31"/><S T="7" X="1450" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="32"/><S T="7" X="1550" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="33"/><S T="7" X="1650" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="34"/><S T="7" X="1750" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="35"/><S T="7" X="1850" Y="2485" L="100" H="40" P="1,0,0.1,0.2,0,0,0,0" lua="36"/><S T="1" X="5" Y="-1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="1" X="2995" Y="-1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/></S><D><DS X="1500" Y="2173"/></D><O/><L/></Z></C>', -- [1-36]
     '<C><P MEDATA=";;;;-0;0:::1-" L="3000" H="3000" F="0" DS="m;1499,2289" C="" Ca="" mc="" reload="true"/><Z><S><S T="6" X="1500" Y="2755" L="3000" H="500" P="1,1000,0.3,0,0,1,9999,0"/><S T="8" X="1500" Y="3100" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="50000" m=""/><S T="0" X="5" Y="3010" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="2995" Y="3010" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="3005" Y="2815" L="10" H="400" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="-5" Y="2815" L="10" H="400" P="0,0,0.3,0.2,0,0,0,0" c="2" m=""/><S T="0" X="1500" Y="3040" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="30000" m=""/><S T="8" X="1500" Y="3205" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="70000" m=""/><S T="0" X="1500" Y="3140" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="50000" m=""/><S T="8" X="1500" Y="3315" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="90000" m=""/><S T="0" X="1500" Y="3245" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="70000" m=""/><S T="0" X="1500" Y="3355" L="10" H="10" P="0,0,0.3,0.2,0,0,0,0" v="90000" m=""/><S T="8" X="1500" Y="3425" L="3000" H="10" P="0,0,0.3,0,0,0,0,0" c="2" v="110000" m=""/><S T="1" X="5" Y="1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="1" X="2995" Y="1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="1" X="5" Y="-1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="1" X="2995" Y="-1250" L="10" H="2500" P="0,0,0,0.2,0,0,0,0"/><S T="10" X="1420" Y="2485" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="59"/><S T="10" X="1420" Y="2405" L="80" H="40" P="1,0,0.3,0,0,0,0,0"/><S T="10" X="1420" Y="2445" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="50"/><S T="10" X="1420" Y="2365" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="37"/><S T="10" X="1420" Y="2325" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="24"/><S T="10" X="1500" Y="2485" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="60"/><S T="10" X="1500" Y="2405" L="80" H="40" P="1,0,0.3,0,0,0,0,0"/><S T="10" X="1500" Y="2445" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="51"/><S T="10" X="1500" Y="2365" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="38"/><S T="10" X="1500" Y="2325" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="25"/><S T="10" X="1580" Y="2485" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="61"/><S T="10" X="1580" Y="2405" L="80" H="40" P="1,0,0.3,0,0,0,0,0"/><S T="10" X="1580" Y="2445" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="52"/><S T="10" X="1580" Y="2365" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="39"/><S T="10" X="1580" Y="2325" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="26"/><S T="10" X="1660" Y="2485" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="62"/><S T="10" X="1660" Y="2405" L="80" H="40" P="1,0,0.3,0,0,0,0,0"/><S T="10" X="1660" Y="2445" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="53"/><S T="10" X="1660" Y="2365" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="40"/><S T="10" X="1660" Y="2325" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="27"/><S T="10" X="1340" Y="2485" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="58"/><S T="10" X="1340" Y="2405" L="80" H="40" P="1,0,0.3,0,0,0,0,0"/><S T="10" X="1340" Y="2445" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="49"/><S T="10" X="1340" Y="2365" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="36"/><S T="10" X="1340" Y="2325" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="23"/><S T="10" X="1280" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="48"/><S T="10" X="1280" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="22"/><S T="10" X="1800" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="30"/><S T="10" X="1840" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="31"/><S T="10" X="1800" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="56"/><S T="10" X="1840" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="57"/><S T="10" X="1280" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="35"/><S T="10" X="1281" Y="2226" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="14"/><S T="10" X="1800" Y="2225" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="17"/><S T="10" X="1840" Y="2225" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="18"/><S T="10" X="1800" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="43"/><S T="10" X="1840" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="44"/><S T="10" X="1240" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="47"/><S T="10" X="1240" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="21"/><S T="10" X="1760" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="29"/><S T="10" X="1760" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="55"/><S T="10" X="1240" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="34"/><S T="10" X="1240" Y="2225" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="13"/><S T="10" X="1760" Y="2225" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="16"/><S T="10" X="1760" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="42"/><S T="10" X="1200" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="46"/><S T="10" X="1160" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="45"/><S T="10" X="1200" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="20"/><S T="10" X="1160" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="19"/><S T="10" X="1720" Y="2305" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="28"/><S T="10" X="1720" Y="2465" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="54"/><S T="10" X="1200" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="33"/><S T="10" X="1160" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="32"/><S T="10" X="1200" Y="2225" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="12"/><S T="10" X="1160" Y="2225" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="11"/><S T="10" X="1280" Y="2165" L="40" H="40" P="1,0,0.3,0,0,0,0,0" lua="8"/><S T="10" X="1340" Y="2084" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="1"/><S T="10" X="1500" Y="2084" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="3"/><S T="10" X="1420" Y="2084" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="2"/><S T="10" X="1580" Y="2084" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="4"/><S T="10" X="1660" Y="2084" L="80" H="40" P="1,0,0.3,0,0,0,0,0" lua="5"/><S T="10" X="1840" Y="2165" L="40" H="40" P="1,0,0.3,0,0,0,0,0" lua="10"/><S T="10" X="1160" Y="2165" L="40" H="40" P="1,0,0.3,0,0,0,0,0" lua="7"/><S T="10" X="1720" Y="2165" L="40" H="40" P="1,0,0.3,0,0,0,0,0" lua="9"/><S T="10" X="1720" Y="2225" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="15"/><S T="10" X="1720" Y="2385" L="40" H="80" P="1,0,0.3,0,0,0,0,0" lua="41"/><S T="8" X="1500" Y="2205" L="400" H="200" P="1,0,0.3,0.2,0,0,0,0" c="2" lua="6"/></S><D/><O/><L/></Z></C>' -- [1-62]
    }, {64, 36, 62}
local textAreaIds = {
    hpBarId = 1,
    hpInfoId = 2,
    leaderboardId = 3
}

for _, i in next, {"AfkDeath", "AutoNewGame", "AutoScore", "AutoShaman", "AutoTimeLeft", "MinimalistMode",
                   "PhysicalConsumables"} do
    tfm.exec["disable" .. i]()
end

eventNewPlayer = function(name)
    if not players[name] then
        players[name] = {
            wins = 0,
            hp = 100,
            imgs = {hpBarImg},
            tempImgs = {}
        }
    end
    if currentMode == "lobby" then
        tfm.exec.respawnPlayer(name)
    end
end

for name in next, tfm.get.room.playerList do
    eventNewPlayer(name)
end

eventPlayerDied = function(name)
    if currentMode == "lobby" then
        tfm.exec.respawnPlayer(name)
    else
        if currentEvent == "earthquake" then
            players[name].hp = players[name].hp - math.random(20, 50)
            local tempX, tempY = tfm.get.room.playerList[name].x, tfm.get.room.playerList[name].y
            tfm.exec.respawnPlayer(name)
            tfm.exec.movePlayer(name, tempX, tempY, false, 0, 0, false)
            hpBarUpdater(name)
        end
        if getAlive()[1] == 1 then
            players[getAlive()[2][1]].wins = players[getAlive()[2][1]].wins + 1
            mapLoader("lobby")
        end
    end
end

eventNewGame = function()
    math.randomseed(os.time())
    if currentMode == "lobby" then
        currentEvent = 0
        for name in next, players do
            players[name].hp = 100
            if players[name].imgs.hpBarImg then
                tfm.exec.removeImage(players[name].imgs.hpBarImg)
                ui.removeTextArea(textAreaIds.hpBarId, name)
                ui.removeTextArea(textAreaIds.hpInfoId, name)
                players[name].imgs.hpBarImg = false
            end
        end
        leaderboardUpdater()
    else
        eventSelector()
        for name in next, players do
            ui.removeTextArea(textAreaIds.leaderboardId, name)
            if not players[name].imgs.hpBarImg then
                players[name].imgs.hpBarImg = tfm.exec.addImage("17141970b92.png", "&1", 2, 25, name, 1.35, 1.35, 0, 1,
                    0, 0)
                ui.addTextArea(textAreaIds.hpBarId, "", name, 9, 32, players[name].hp * 256 / 100, 6, 0xff0000,
                    0xff0000, 1, 1)
                ui.addTextArea(textAreaIds.hpInfoId, "<p align='center'><font color='#000000'><font size='11'>" ..
                    players[name].hp .. " / 100</font></font></p>", name, 9, 25, 250, 21, 0x000000, 0x000000, 1, 1)
            end
        end
    end
end

local k, timer = 10, 0
eventLoop = function(cT, rT)
    if currentMode ~= "lobby" then
        if currentEvent == "acidRain" and cT >= 5000 then
            if timer == 4 then
                for i = (mapObjects[currentMap] * k) + 1, ((mapObjects[currentMap] * k) + 1) + 25 do
                    tfm.exec.addPhysicObject(i, math.random(30, 2950), math.random(100, 400), {
                        type = 12,
                        color = 0x00cc00,
                        dynamic = true,
                        contactListener = true
                    })
                end
                k = k * 10
                if k >= 1000000 then
                    k = 10
                end
                timer = 0
            else
                timer = timer + 1
            end
        elseif currentEvent == "earthquake" and cT >= 5000 and cT <= 5500 then
            tfm.exec.setAieMode()
            tfm.exec.addPhysicObject(501, -50, 2497, {type = 14, width = 3500, height = 10, groundCollision = false})
            for i = 1, 5 do
                tfm.exec.addPhysicObject(i * 100, 1300, 3150, {
                    type = 12,
                    width = math.random(250, 550),
                    height = math.random(250, 550),
                    restution = math.random(1.5, 5),
                    friction = 0,
                    dynamic = true,
                    linearDamping = math.random(2, 5)
                })
            end
        end
    end
end

eventContactListener = function(name, id, info)
    players[name].hp = players[name].hp - math.random(5, 10)
    if not tfm.get.room.playerList[name].isDead then
        hpBarUpdater(name)
    end
end

eventChatCommand = function(name, cmd)
    if admins[name] then
        if cmd == "a" then
            mapLoader("lobby")
        else
            mapLoader()
        end
    end
end

mapLoader = function(mapType)
    currentMap = mapType == "lobby" and math.random(#lobbyMaps) or math.random(#maps)
    tfm.exec.newGame(mapType == "lobby" and lobbyMaps[currentMap] or maps[currentMap])
    currentMode = mapType
end

eventSelector = function()
    local disasters = {"acidRain", "earthquake"}
    currentEvent = disasters[math.random(#disasters)]
end

-------------------------------- CHECKERS ----------------------------------
getAlive = function()
    local count, aliveList = 0, {}
    for name in next, players do
        if players[name].hp > 0 then
            aliveList[#aliveList + 1] = name
            count = count + 1
        end
    end
    return {count, aliveList}
end
----------------------------------------------------------------------------
------------------------------ UI UPDATERS ---------------------------------
hpBarUpdater = function(name)
    if players[name].hp <= 0 then
        tfm.exec.killPlayer(name)
        tfm.exec.removeImage(players[name].imgs.hpBarImg)
        ui.removeTextArea(textAreaIds.hpBarId, name)
        ui.removeTextArea(textAreaIds.hpInfoId, name)
        players[name].imgs.hpBarImg = false
    else
        ui.addTextArea(textAreaIds.hpBarId, "", name, 9, 32, players[name].hp * 256 / 100, 6, 0xff0000, 0xff0000, 1, 1)
        ui.updateTextArea(textAreaIds.hpInfoId, "<p align='center'><font color='#000000'><font size='11'>" ..
            players[name].hp .. " / 100</font></font></p>", name)
    end
end

leaderboardUpdater = function()
    local leaderboardText = "<p align='left'><font color='#000000'>\n"
    local count = 1
    for name in next, players do
        leaderboardText = leaderboardText .. name .. " : " .. players[name].wins .. "\n"
    end
    leaderboardText = leaderboardText .. "</font></p>"
    for name in next, players do
        ui.addTextArea(textAreaIds.leaderboardId, leaderboardText, name, 300, 50, 200, 100, nil, nil, 0, true)
    end
end
----------------------------------------------------------------------
mapLoader("lobby")
